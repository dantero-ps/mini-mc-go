---
phase: 12
name: Implement 1.8.9 World Gen Logic
wave: 1
depends_on: []
files_modified:
  - internal/world/noise_authentic.go
  - internal/world/chunk_provider_189.go
  - internal/world/chunk_provider_189_test.go
autonomous: true
must_haves:
  truths:
    - "Authentic noise generators produce deterministic outputs based on seed"
    - "ChunkProvider189 produces 16x16x256 chunk data"
    - "Density field generation follows MC 1.8.9 algorithms (tri-linear interpolation)"
  artifacts:
    - path: "internal/world/noise_authentic.go"
      provides: "Noise generation logic"
    - path: "internal/world/chunk_provider_189.go"
      provides: "Chunk generation logic"
    - path: "internal/world/chunk_provider_189_test.go"
      provides: "Tests"
  key_links: []
---

# Plan: Implement 1.8.9 World Gen Logic

This plan focuses on implementing the core backend logic for authentic Minecraft 1.8.9 world generation. It involves fixing existing syntax errors in the ported noise code and implementing the density generation pipeline.

## Understanding
We need to replicate the `ChunkProviderGenerate` logic from MC 1.8.9.
Key components:
1.  **Noise Generators:** `NoiseGeneratorOctaves` (Perlin), `NoiseGeneratorImproved` (Perlin variant).
2.  **Density Calculation:** 5x5x33 grid generation using depth, main, min, and max noise generators.
3.  **Interpolation:** Filling the 16x16x256 chunk from the 5x5x33 grid.
4.  **Biome Blending:** A parabolic weighting system to blend biomes.

The file `internal/world/noise_authentic.go` exists but reportedly contains syntax errors (likely Java ternary operators `? :` left over from porting).

## Tasks

<tasks>
<task type="auto">
  <name>Fix Noise Implementation</name>
  <files>internal/world/noise_authentic.go</files>
  <action>Read `internal/world/noise_authentic.go` and fix any syntax errors (e.g., ternary operators). Ensure `AuthenticNoiseGeneratorOctaves` and `AuthenticNoiseGeneratorImproved` are correctly implemented and exported. Add unit tests for `noise_authentic.go` to ensure it produces values without panicking.</action>
  <verify>Run `go test ./internal/world/...` and ensure noise tests pass.</verify>
  <done>Noise generators fixed and verified.</done>
</task>

<task type="auto">
  <name>Create ChunkProvider189</name>
  <files>internal/world/chunk_provider_189.go</files>
  <action>Create `internal/world/chunk_provider_189.go`. Define `ChunkProvider189` struct holding the noise generators. Implement `NewChunkProvider189(seed int64)` to initialize the generators.</action>
  <verify>Check that the file compiles and the struct is available.</verify>
  <done>ChunkProvider189 struct created.</done>
</task>

<task type="auto">
  <name>Implement Density Generation</name>
  <files>internal/world/chunk_provider_189.go</files>
  <action>Implement `generateHighLowNoise` (equivalent to `initializeNoiseField` in MCP) in `ChunkProvider189`. Use the standard MC 1.8.9 constants (Coordinate scaling 684.412, etc, Depth/Main/Min/Max noise usage). Implement biome weighting (parabolic field over 5x5 area). Output a flat float array representing the 5x5x33 density field.</action>
  <verify>Add a test case in `chunk_provider_189_test.go` to verify density array contains expected range of values.</verify>
  <done>Density generation implemented.</done>
</task>

<task type="auto">
  <name>Implement Chunk Population</name>
  <files>internal/world/chunk_provider_189.go</files>
  <action>Implement `GenerateChunk(x, z int) *Chunk`. Call `generateHighLowNoise` to get density. Implement tri-linear interpolation to fill the 16x16x256 block data from the 5x5x33 density. Set blocks based on density (Stone if > 0, Air/Water if <= 0).</action>
  <verify>Generate a chunk in test and verify it contains both Stone and Air blocks.</verify>
  <done>Chunk population working.</done>
</task>

<task type="auto">
  <name>Verification</name>
  <files>internal/world/chunk_provider_189_test.go</files>
  <action>Create `internal/world/chunk_provider_189_test.go`. Test that `GenerateChunk` runs and returns a chunk with non-empty blocks. Assert determinism: Generating the same chunk (x, z) twice produces identical data.</action>
  <verify>Run all tests in `internal/world`.</verify>
  <done>Full verification complete.</done>
</task>
</tasks>

<verification>
`internal/world/noise_authentic.go` compiles and passes tests.
`ChunkProvider189` generates chunks with 3D terrain (stone/air).
Determinism holds true.
</verification>

<success_criteria>
Authentic world generation logic implemented and verified.
</success_criteria>

<output>
After completion, create `.planning/phases/12-implement-1-8-9-world-gen-logic-config-menus/12-01-SUMMARY.md`
</output>
